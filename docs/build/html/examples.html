
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Usage Examples &#8212; psims  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Basic XML Components" href="xml.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="usage-examples">
<h1>Usage Examples<a class="headerlink" href="#usage-examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="writing-mzml">
<h2>Writing mzML<a class="headerlink" href="#writing-mzml" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>In this example, we’ll walk through the steps involved in writing an mzML file containing simulated data.</p>
<p>Writing an mzML file with <code class="xref py py-mod docutils literal notranslate"><span class="pre">psims</span></code> is done using the <a class="reference internal" href="mzml/writer.html#psims.mzml.writer.MzMLWriter" title="psims.mzml.writer.MzMLWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">MzMLWriter</span></code></a> class.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">psims.mzml</span> <span class="k">import</span> <span class="n">MzMLWriter</span>
</pre></div>
</div>
<p>To begin, you create the writer with a file path, or a previously created file-like object:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">writer</span> <span class="o">=</span> <span class="n">MzMLWriter</span><span class="p">(</span><span class="s2">&quot;path/to/write.mzML&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Before any content can be written out, the writer must start the document, which can be done by either
using it as a context manager, or by calling it’s <a class="reference internal" href="mzml/writer.html#psims.mzml.writer.MzMLWriter.begin" title="psims.mzml.writer.MzMLWriter.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">begin()</span></code></a> method.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">writer</span><span class="p">:</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">controlled_vocabularies</span><span class="p">()</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The above example uses the context manager syntax, and immediately writes the controlled vocabulary
list to the document. This starts the standard-compliance state-machine, which checks to make sure that
a document proceeds through each section in the expected order, without skipping required sections. The
remainder of these code samples will take place within this context manager.</p>
<p>The next step is to describe the contents of the file to be written. This includes both provenance
information (where the data came from) and classification of the types of spectra contained (MS1 and/or
MSn spectra, centroid vs. profile spectra). In this example, we’ll generate some data <em>de novo</em>, and
so won’t have any <code class="docutils literal notranslate"><span class="pre">&lt;sourceFile&gt;</span></code> elements.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">writer</span><span class="o">.</span><span class="n">file_description</span><span class="p">([</span> <span class="c1"># the list of file contents terms</span>
    <span class="s2">&quot;MS1 spectrum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MSn spectrum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;centroid spectrum&quot;</span>
<span class="p">])</span>
</pre></div>
</div>
<p>If a <code class="docutils literal notranslate"><span class="pre">&lt;sourceFile&gt;</span></code> is needed, it can be built using</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sf</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">SourceFile</span><span class="p">(</span><span class="s2">&quot;file://path/to/the&quot;</span><span class="p">,</span> <span class="s2">&quot;file_name.ext&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;RAW1&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="c1"># If you need to checksum a local file</span>
<span class="n">sf</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">checksum</span><span class="p">(</span><span class="s1">&#39;sha-1&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The next required list is <code class="docutils literal notranslate"><span class="pre">&lt;softwareList&gt;</span></code>. Replace the names here with your own tools if needed:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">writer</span><span class="o">.</span><span class="n">software_list</span><span class="p">([</span>
    <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;psims-writer&quot;</span><span class="p">,</span>
     <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.2&quot;</span><span class="p">,</span>
     <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;python-psims&quot;</span><span class="p">,</span>
    <span class="p">]}</span>
<span class="p">])</span>
</pre></div>
</div>
<p>The instrument configuration list is a bit more involved to specify. For example, an ESI FT-ICR
system would be described by:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;electrospray ionization&quot;</span><span class="p">,</span> <span class="s2">&quot;electrospray inlet&quot;</span><span class="p">])</span>
<span class="n">analyzer</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">Analyzer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span>
        <span class="s2">&quot;&quot;</span><span class="n">fourier</span> <span class="n">transform</span> <span class="n">ion</span> <span class="n">cyclotron</span> <span class="n">resonance</span> <span class="n">mass</span> <span class="n">spectrometer</span><span class="s2">&quot;</span>
    <span class="p">])</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">Detector</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;inductive detector&quot;</span><span class="p">])</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">InstrumentConfiguration</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;IC1&quot;</span><span class="p">,</span> <span class="n">component_list</span><span class="o">=</span><span class="p">[</span><span class="n">source</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">detector</span><span class="p">],</span>
                                        <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;LTQ-FT&quot;</span><span class="p">])</span>
<span class="n">writer</span><span class="o">.</span><span class="n">instrument_configuration_list</span><span class="p">([</span><span class="n">config</span><span class="p">])</span>
</pre></div>
</div>
<p>Multiple configurations may be specified.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;dataProcessing&gt;</span></code> instructions can be as intricate as needed, as in this case:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">methods</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">ProcessingMethod</span><span class="p">(</span>
        <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sofware_reference</span><span class="o">=</span><span class="s2">&quot;psims-writer&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;Gaussian smoothing&quot;</span><span class="p">,</span>
            <span class="s2">&quot;median baseline reduction&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MS:1000035&quot;</span><span class="p">,</span> <span class="c1"># peak picking</span>
            <span class="s2">&quot;Conversion to mzML&quot;</span>
        <span class="p">]))</span>
<span class="n">processing</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">DataProcessing</span><span class="p">(</span><span class="n">methods</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;DP1&#39;</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">data_processing_list</span><span class="p">([</span><span class="n">processing</span><span class="p">])</span>
</pre></div>
</div>
<p>Now, we’re nearly ready to start writing spectra. To start, we open the run and spectrum list:</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">with</span> <span class="n">writer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">instrument_configuration</span><span class="o">=</span><span class="s1">&#39;IC1&#39;</span><span class="p">):</span>
    <span class="c1"># we will write 3,000 spectra</span>
    <span class="k">with</span> <span class="n">writer</span><span class="o">.</span><span class="n">spectrum_list</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="mf">1e3</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>We write all spectra within the inner context manager of the spectrum list, or instead of
using the context manager notation, call the <a class="reference internal" href="xml.html#psims.xml.XMLDocumentWriter.begin" title="psims.xml.XMLDocumentWriter.begin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">begin()</span></code></a> and
<a class="reference internal" href="xml.html#psims.xml.XMLDocumentWriter.end" title="psims.xml.XMLDocumentWriter.end"><code class="xref py py-meth docutils literal notranslate"><span class="pre">end()</span></code></a> methods.</p>
<p>A spectrum is a collection of many complex details. We’ll use <cite>NumPy</cite> arrays
to represent the data arrays. This file contains centroided spectra as previously specified in
the file description.</p>
<p>We’ll assume there’s a function that generates a centroided spectrum, called <code class="docutils literal notranslate"><span class="pre">get_next_arrays</span></code>
to produce those arrays.</p>
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mf">1e3</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">ms1_mzs</span><span class="p">,</span> <span class="n">ms1_intensities</span> <span class="o">=</span> <span class="n">get_next_arrays</span><span class="p">()</span>
    <span class="n">ms1_spectrum_id</span> <span class="o">=</span> <span class="s2">&quot;index=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span>
    <span class="n">scan_time</span> <span class="o">=</span> <span class="mf">0.23</span> <span class="o">*</span> <span class="n">i</span>

    <span class="n">writer</span><span class="o">.</span><span class="n">write_spectrum</span><span class="p">(</span>
        <span class="n">ms1_mzs</span><span class="p">,</span> <span class="n">ms1_intensities</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">ms1_spectrum_id</span><span class="p">,</span> <span class="n">centroided</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">scan_start_time</span><span class="o">=</span><span class="n">scan_time</span><span class="p">,</span> <span class="n">scan_window_list</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2000.0</span><span class="p">)],</span>
        <span class="n">params</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;ms level&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;total ion current&quot;</span><span class="p">:</span> <span class="n">ms1_intensities</span><span class="o">.</span><span class="n">sum</span><span class="p">()}])</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">msn_mzs</span><span class="p">,</span> <span class="n">msn_intensities</span> <span class="o">=</span> <span class="n">get_next_arrays</span><span class="p">()</span>
        <span class="n">msn_spectrum_id</span> <span class="o">=</span> <span class="s2">&quot;index=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span>
        <span class="n">scan_time</span> <span class="o">=</span> <span class="mf">0.23</span> <span class="o">*</span> <span class="n">i</span>

        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ms1_mzs</span><span class="p">))</span>
        <span class="n">precursor_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mz&quot;</span><span class="p">:</span> <span class="n">ms1_mzs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="s1">&#39;intensity&#39;</span><span class="p">:</span> <span class="n">ms1_intensities</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
            <span class="s2">&quot;spectrum_reference&quot;</span><span class="p">:</span> <span class="n">ms1_spectrum_id</span><span class="p">,</span>
            <span class="s2">&quot;activation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;HCD&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;collision energy&quot;</span><span class="p">:</span> <span class="mf">25.0</span><span class="p">}],</span>
            <span class="s2">&quot;isolation_window&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ms1_mzs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">}</span>


        <span class="n">writer</span><span class="o">.</span><span class="n">write_spectrum</span><span class="p">(</span>
            <span class="n">msn_mzs</span><span class="p">,</span> <span class="n">msn_intensities</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">msn_spectrum_id</span><span class="p">,</span> <span class="n">centroided</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">scan_start_time</span><span class="o">=</span><span class="n">scan_time</span><span class="p">,</span> <span class="n">scan_window_list</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2000.0</span><span class="p">)],</span>
            <span class="n">precursor_information</span><span class="o">=</span><span class="n">precursor_info</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;ms level&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;total ion current&quot;</span><span class="p">:</span> <span class="n">msn_intensities</span><span class="o">.</span><span class="n">sum</span><span class="p">()}])</span>
</pre></div>
</div>
<p>Similar code can be used for writing chromatograms, see <code class="xref py py-meth docutils literal notranslate"><span class="pre">write_chromatogram()</span></code>.</p>
<p>Once the document is finished, we leave the top-level context manager, and we can index the file
using <a class="reference internal" href="mzml/writer.html#psims.mzml.writer.MzMLWriter.format" title="psims.mzml.writer.MzMLWriter.format"><code class="xref py py-meth docutils literal notranslate"><span class="pre">format()</span></code></a> method.</p>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">psims</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="mzml/index.html">mzML</a></li>
<li class="toctree-l1"><a class="reference internal" href="mzid/index.html">mzIdentML</a></li>
<li class="toctree-l1"><a class="reference internal" href="xml.html">XML Utilities</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#writing-mzml">Writing mzML</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="xml.html" title="previous chapter">Basic XML Components</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Joshua Klein.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/examples.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>